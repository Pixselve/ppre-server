# Migration `watch-20191129153953`

This migration has been generated by Mael Kerichard at 11/29/2019, 3:40:08 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "lift"."User.email"

DROP TABLE "lift"."Post";

DROP TABLE "lift"."User";

CREATE TABLE "lift"."School" (
  "academy" TEXT NOT NULL   REFERENCES "Academy"(id) ON DELETE RESTRICT,
  "city" TEXT NOT NULL DEFAULT ''  ,
  "collegeSector" TEXT NOT NULL DEFAULT ''  ,
  "createdAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "district" TEXT NOT NULL DEFAULT ''  ,
  "id" TEXT NOT NULL   ,
  "name" TEXT NOT NULL DEFAULT ''  ,
  "phone" TEXT NOT NULL DEFAULT ''  ,
  "webstite" TEXT    ,
  PRIMARY KEY ("id")
);

CREATE TABLE "lift"."SchoolYear" (
  "from" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "id" TEXT NOT NULL   ,
  "school" TEXT NOT NULL   REFERENCES "School"(id) ON DELETE RESTRICT,
  "to" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  PRIMARY KEY ("id")
);

CREATE TABLE "lift"."StudentYear" (
  "classroom" TEXT    REFERENCES "Classroom"(id) ON DELETE SET NULL,
  "id" TEXT NOT NULL   ,
  "schoolYear" TEXT NOT NULL   REFERENCES "SchoolYear"(id) ON DELETE RESTRICT,
  "student" TEXT NOT NULL   REFERENCES "Student"(id) ON DELETE RESTRICT,
  PRIMARY KEY ("id")
);

CREATE TABLE "lift"."Teacher" (
  "avatar" TEXT    ,
  "createdAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "email" TEXT NOT NULL DEFAULT ''  ,
  "firstName" TEXT NOT NULL DEFAULT ''  ,
  "id" TEXT NOT NULL   ,
  "lastName" TEXT NOT NULL DEFAULT ''  ,
  "password" TEXT NOT NULL DEFAULT ''  ,
  "role" TEXT NOT NULL DEFAULT ''  ,
  "school" TEXT NOT NULL   REFERENCES "School"(id) ON DELETE RESTRICT,
  "username" TEXT NOT NULL DEFAULT ''  ,
  PRIMARY KEY ("id")
);

CREATE TABLE "lift"."Student" (
  "birthDate" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "firstName" TEXT NOT NULL DEFAULT ''  ,
  "gender" TEXT NOT NULL DEFAULT ''  ,
  "id" TEXT NOT NULL   ,
  "lastName" TEXT NOT NULL DEFAULT ''  ,
  "password" TEXT NOT NULL DEFAULT ''  ,
  "username" TEXT NOT NULL DEFAULT ''  ,
  PRIMARY KEY ("id")
);

CREATE TABLE "lift"."Classroom" (
  "academicLevel" TEXT NOT NULL DEFAULT ''  ,
  "id" TEXT NOT NULL   ,
  "name" TEXT NOT NULL DEFAULT ''  ,
  "schoolYear" TEXT NOT NULL   REFERENCES "SchoolYear"(id) ON DELETE RESTRICT,
  PRIMARY KEY ("id")
);

CREATE TABLE "lift"."Ppre" (
  "councilRenewalOpinion" TEXT    ,
  "councilRenewalOpinionDate" DATE    ,
  "globalAssessment" TEXT    ,
  "id" TEXT NOT NULL   ,
  "nativeLanguage" TEXT    ,
  "nature" TEXT    ,
  "orientationProposalOrganization" TEXT    ,
  "orientationProposalResult" BOOLEAN    ,
  "renewal" BOOLEAN    ,
  "retentionProposalAcademicLevel" TEXT    ,
  "retentionProposalResult" BOOLEAN    ,
  "schoolAttendance" TEXT    ,
  "studentYear" TEXT NOT NULL   REFERENCES "StudentYear"(id) ON DELETE RESTRICT,
  PRIMARY KEY ("id")
);

CREATE TABLE "lift"."PpreCheckup" (
  "assessment" TEXT NOT NULL DEFAULT ''  ,
  "id" TEXT NOT NULL   ,
  "ppre" TEXT NOT NULL   REFERENCES "Ppre"(id) ON DELETE RESTRICT,
  PRIMARY KEY ("id")
);

CREATE TABLE "lift"."Skill" (
  "id" TEXT NOT NULL   ,
  "name" TEXT NOT NULL DEFAULT ''  ,
  "parent" TEXT    REFERENCES "Skill"(id) ON DELETE SET NULL,
  "ppreCheckup" TEXT    REFERENCES "PpreCheckup"(id) ON DELETE SET NULL,
  "schoolYear" TEXT NOT NULL   REFERENCES "SchoolYear"(id) ON DELETE RESTRICT,
  PRIMARY KEY ("id")
);

CREATE TABLE "lift"."Academy" (
  "id" TEXT NOT NULL   ,
  "imageName" TEXT NOT NULL DEFAULT ''  ,
  "name" TEXT NOT NULL DEFAULT ''  ,
  PRIMARY KEY ("id")
);

CREATE TABLE "lift"."Ppre_schoolingArrangements" (
  "nodeId" TEXT NOT NULL   REFERENCES "Ppre"(id) ON DELETE CASCADE,
  "position" INTEGER NOT NULL   ,
  "value" TEXT NOT NULL   ,
  PRIMARY KEY ("nodeId","position")
);

CREATE TABLE "lift"."Ppre_externalSupport" (
  "nodeId" TEXT NOT NULL   REFERENCES "Ppre"(id) ON DELETE CASCADE,
  "position" INTEGER NOT NULL   ,
  "value" TEXT NOT NULL   ,
  PRIMARY KEY ("nodeId","position")
);

CREATE TABLE "lift"."_ClassroomToTeacher" (
  "A" TEXT NOT NULL   REFERENCES "Classroom"(id) ON DELETE CASCADE,
  "B" TEXT NOT NULL   REFERENCES "Teacher"(id) ON DELETE CASCADE
);

CREATE TABLE "lift"."_SkillsConcernedToPPRE" (
  "A" TEXT NOT NULL   REFERENCES "Ppre"(id) ON DELETE CASCADE,
  "B" TEXT NOT NULL   REFERENCES "Skill"(id) ON DELETE CASCADE
);

CREATE TABLE "lift"."_SkillsToWorkToPPRE" (
  "A" TEXT NOT NULL   REFERENCES "Ppre"(id) ON DELETE CASCADE,
  "B" TEXT NOT NULL   REFERENCES "Skill"(id) ON DELETE CASCADE
);

CREATE UNIQUE INDEX "lift"."School.id" ON "School"("id")

CREATE UNIQUE INDEX "lift"."SchoolYear.id" ON "SchoolYear"("id")

CREATE UNIQUE INDEX "lift"."StudentYear.id" ON "StudentYear"("id")

CREATE UNIQUE INDEX "lift"."Teacher.id" ON "Teacher"("id")

CREATE UNIQUE INDEX "lift"."Teacher.username" ON "Teacher"("username")

CREATE UNIQUE INDEX "lift"."Teacher.email" ON "Teacher"("email")

CREATE UNIQUE INDEX "lift"."Student.id" ON "Student"("id")

CREATE UNIQUE INDEX "lift"."Student.username" ON "Student"("username")

CREATE UNIQUE INDEX "lift"."Classroom.id" ON "Classroom"("id")

CREATE UNIQUE INDEX "lift"."Ppre.id" ON "Ppre"("id")

CREATE UNIQUE INDEX "lift"."PpreCheckup.id" ON "PpreCheckup"("id")

CREATE UNIQUE INDEX "lift"."Skill.id" ON "Skill"("id")

CREATE UNIQUE INDEX "lift"."Academy.id" ON "Academy"("id")

CREATE UNIQUE INDEX "lift"."Academy.imageName" ON "Academy"("imageName")

CREATE UNIQUE INDEX "lift"."_ClassroomToTeacher_AB_unique" ON "_ClassroomToTeacher"("A","B")

CREATE UNIQUE INDEX "lift"."_SkillsConcernedToPPRE_AB_unique" ON "_SkillsConcernedToPPRE"("A","B")

CREATE UNIQUE INDEX "lift"."_SkillsToWorkToPPRE_AB_unique" ON "_SkillsToWorkToPPRE"("A","B")
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration watch-20191129152509..watch-20191129153953
--- datamodel.dml
+++ datamodel.dml
@@ -3,24 +3,150 @@
 }
 datasource db {
   provider = "sqlite"
-  url = "***"
+  url      = "file:dev.db"
 }
-model Post {
-  id        String   @default(cuid()) @id
-  createdAt DateTime @default(now())
-  updatedAt DateTime @updatedAt
-  published Boolean  @default(false)
-  title     String
-  content   String?
-  author    User?
+model School {
+    id                 String             @default(cuid()) @id @unique
+    name               String
+    webstite           String?
+    phone              String
+    city String
+    academy Academy
+    createdAt          DateTime           @default(now())
+    schoolYears SchoolYear[]
+    teachers Teacher[]
+    collegeSector String
+    district String
 }
-model User {
-  id       String  @default(cuid()) @id
-  email    String  @unique
-  password String
-  name     String?
-  posts    Post[]
+model SchoolYear {
+    id                 String             @default(cuid()) @id @unique
+    from      DateTime
+    to        DateTime
+    school School
+    studentYears StudentYear[]
+    classrooms         Classroom[]
+    skills Skill[]
+}
+
+model StudentYear {
+    id                 String             @default(cuid()) @id @unique
+    schoolYear SchoolYear
+    student Student
+    classroom Classroom?
+    ppre Ppre?
+}
+
+model Teacher {
+    id         String      @default(cuid()) @id @unique
+    firstName  String
+    lastName   String
+    school     School
+    avatar     String?
+    role       String
+    username   String      @unique
+    email      String      @unique
+    password   String
+    createdAt  DateTime    @default(now())
+    classrooms Classroom[]
+}
+
+model Student {
+    id         String             @default(cuid()) @id @unique
+    firstName  String
+    lastName   String
+    birthDate  DateTime
+    gender     String
+    username   String             @unique
+    password   String
+    studentYears StudentYear[]
+}
+
+model Classroom {
+    id                 String             @default(cuid()) @id @unique
+    name               String
+    teachers           Teacher[]
+    academicLevel      String
+    schoolYear SchoolYear
+    studentYears StudentYear[]
+}
+
+model Ppre {
+    id                String            @default(cuid()) @id @unique
+    studentYear StudentYear
+    globalAssessment  String?
+    nature            String?
+    schoolAttendance  String?
+    checkups          PpreCheckup[]
+    skillsConcerned   Skill[]           @relation(name: "SkillsConcernedToPPRE")
+    skillsToWork      Skill[]           @relation(name: "SkillsToWorkToPPRE")
+    nativeLanguage String?
+    schoolingArrangements String[]
+    externalSupport String[]
+    retentionProposalAcademicLevel String?
+    retentionProposalResult Boolean?
+    orientationProposalOrganization String?
+    orientationProposalResult Boolean?
+    renewal  Boolean?
+    councilRenewalOpinion String?
+    councilRenewalOpinionDate DateTime?
+}
+
+model PpreCheckup {
+    id          String  @default(cuid()) @id @unique
+    ppre        Ppre
+    assessment  String
+    skillsWorked Skill[]
+}
+
+model Skill {
+    id                  String  @default(cuid()) @id @unique
+    name                String
+    children            Skill[] @relation(name: "SkillRelation")
+    parent              Skill?  @relation(name: "SkillRelation", onDelete: CASCADE)
+    schoolYear SchoolYear
+    skillsConcernedPpres Ppre[] @relation(name: "SkillsConcernedToPPRE")
+    skillsToWorkPpres Ppre[] @relation(name: "SkillsToWorkToPPRE")
+}
+
+model Academy {
+    id         String             @default(cuid()) @id @unique
+    name String
+    imageName String @unique
+}
+
+enum Role {
+    DEFAULT
+    MANAGER
+    ADMIN
+}
+
+enum Gender {
+    MALE
+    FEMALE
+    OTHER
+}
+
+enum PPRENature {
+    REMEDIATION
+    SUPPORT
+    UPGRADE
+}
+
+enum SchoolAttendance {
+    ALWAYS
+    SHORTFREQUENTABSENCES
+    LONGABSENCES
+    FREQUENTDELAYS
+}
+
+enum AcademicLevel {
+    CP
+    CE1
+    CE2
+    CM1
+    CM2
+    SIXIEME
 }
```

## Photon Usage

You can use a specific Photon built for this migration (watch-20191129153953)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/watch-20191129153953'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
