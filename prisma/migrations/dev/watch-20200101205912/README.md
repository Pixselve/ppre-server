# Migration `watch-20200101205912`

This migration has been generated by Mael Kerichard at 1/1/2020, 8:59:31 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "main"."User.email"

CREATE TABLE "main"."School" (
  "city" text  NOT NULL DEFAULT '' ,
  "collegeSector" text  NOT NULL DEFAULT '' ,
  "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "district" text  NOT NULL DEFAULT '' ,
  "id" text  NOT NULL  ,
  "name" text  NOT NULL DEFAULT '' ,
  "phone" text  NOT NULL DEFAULT '' ,
  "webstite" text    ,
  PRIMARY KEY ("id")
);

CREATE TABLE "main"."SchoolYear" (
  "from" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text  NOT NULL  ,
  "to" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "main"."StudentYear" (
  "id" text  NOT NULL  ,
  PRIMARY KEY ("id")
);

CREATE TABLE "main"."Teacher" (
  "avatar" text    ,
  "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "email" text  NOT NULL DEFAULT '' ,
  "firstName" text  NOT NULL DEFAULT '' ,
  "id" text  NOT NULL  ,
  "lastName" text  NOT NULL DEFAULT '' ,
  "password" text  NOT NULL DEFAULT '' ,
  "role" text  NOT NULL DEFAULT '' ,
  "username" text  NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "main"."Student" (
  "birthDate" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "firstName" text  NOT NULL DEFAULT '' ,
  "gender" text  NOT NULL DEFAULT '' ,
  "id" text  NOT NULL  ,
  "lastName" text  NOT NULL DEFAULT '' ,
  "password" text  NOT NULL DEFAULT '' ,
  "username" text  NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "main"."Classroom" (
  "academicLevel" text  NOT NULL DEFAULT '' ,
  "id" text  NOT NULL  ,
  "name" text  NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "main"."Ppre" (
  "councilRenewalOpinion" text    ,
  "councilRenewalOpinionDate" timestamp(3)    ,
  "externalSupport" text []   ,
  "globalAssessment" text    ,
  "id" text  NOT NULL  ,
  "nativeLanguage" text    ,
  "nature" text    ,
  "orientationProposalOrganization" text    ,
  "orientationProposalResult" boolean    ,
  "renewal" boolean    ,
  "retentionProposalAcademicLevel" text    ,
  "retentionProposalResult" boolean    ,
  "schoolAttendance" text    ,
  "schoolingArrangements" text []   ,
  PRIMARY KEY ("id")
);

CREATE TABLE "main"."PpreCheckup" (
  "assessment" text  NOT NULL DEFAULT '' ,
  "id" text  NOT NULL  ,
  PRIMARY KEY ("id")
);

CREATE TABLE "main"."Skill" (
  "id" text  NOT NULL  ,
  "name" text  NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "main"."Academy" (
  "id" text  NOT NULL  ,
  "imageName" text  NOT NULL DEFAULT '' ,
  "name" text  NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "main"."_ClassroomToTeacher" (
  "A" text  NOT NULL  REFERENCES "main"."Classroom"("id") ON DELETE CASCADE,
  "B" text  NOT NULL  REFERENCES "main"."Teacher"("id") ON DELETE CASCADE
);

CREATE TABLE "main"."_SkillsConcernedToPPRE" (
  "A" text  NOT NULL  REFERENCES "main"."Ppre"("id") ON DELETE CASCADE,
  "B" text  NOT NULL  REFERENCES "main"."Skill"("id") ON DELETE CASCADE
);

CREATE TABLE "main"."_SkillsToWorkToPPRE" (
  "A" text  NOT NULL  REFERENCES "main"."Ppre"("id") ON DELETE CASCADE,
  "B" text  NOT NULL  REFERENCES "main"."Skill"("id") ON DELETE CASCADE
);

ALTER TABLE "main"."School" ADD COLUMN "academy" text  NOT NULL  REFERENCES "main"."Academy"("id") ON DELETE RESTRICT;

ALTER TABLE "main"."SchoolYear" ADD COLUMN "school" text  NOT NULL  REFERENCES "main"."School"("id") ON DELETE RESTRICT;

ALTER TABLE "main"."StudentYear" ADD COLUMN "classroom" text    REFERENCES "main"."Classroom"("id") ON DELETE SET NULL,
ADD COLUMN "schoolYear" text  NOT NULL  REFERENCES "main"."SchoolYear"("id") ON DELETE RESTRICT,
ADD COLUMN "student" text  NOT NULL  REFERENCES "main"."Student"("id") ON DELETE RESTRICT;

ALTER TABLE "main"."Teacher" ADD COLUMN "school" text  NOT NULL  REFERENCES "main"."School"("id") ON DELETE RESTRICT;

ALTER TABLE "main"."Classroom" ADD COLUMN "schoolYear" text  NOT NULL  REFERENCES "main"."SchoolYear"("id") ON DELETE RESTRICT;

ALTER TABLE "main"."Ppre" ADD COLUMN "studentYear" text  NOT NULL  REFERENCES "main"."StudentYear"("id") ON DELETE RESTRICT;

ALTER TABLE "main"."PpreCheckup" ADD COLUMN "ppre" text  NOT NULL  REFERENCES "main"."Ppre"("id") ON DELETE RESTRICT;

ALTER TABLE "main"."Skill" ADD COLUMN "parent" text    REFERENCES "main"."Skill"("id") ON DELETE SET NULL,
ADD COLUMN "ppreCheckup" text    REFERENCES "main"."PpreCheckup"("id") ON DELETE SET NULL,
ADD COLUMN "schoolYear" text  NOT NULL  REFERENCES "main"."SchoolYear"("id") ON DELETE RESTRICT;

DROP TABLE "main"."Post";

DROP TABLE "main"."User";

CREATE UNIQUE INDEX "Teacher.username" ON "main"."Teacher"("username")

CREATE UNIQUE INDEX "Teacher.email" ON "main"."Teacher"("email")

CREATE UNIQUE INDEX "Student.username" ON "main"."Student"("username")

CREATE UNIQUE INDEX "Ppre_studentYear" ON "main"."Ppre"("studentYear")

CREATE UNIQUE INDEX "Academy.imageName" ON "main"."Academy"("imageName")

CREATE UNIQUE INDEX "_ClassroomToTeacher_AB_unique" ON "main"."_ClassroomToTeacher"("A","B")

CREATE UNIQUE INDEX "_SkillsConcernedToPPRE_AB_unique" ON "main"."_SkillsConcernedToPPRE"("A","B")

CREATE UNIQUE INDEX "_SkillsToWorkToPPRE_AB_unique" ON "main"."_SkillsToWorkToPPRE"("A","B")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration watch-20191129153953..watch-20200101205912
--- datamodel.dml
+++ datamodel.dml
@@ -3,13 +3,19 @@
 }
 datasource db {
   provider = "sqlite"
-  url = "***"
+  url      = "file:dev.db"
+    enabled = false
 }
+datasource postgresql {
+  provider = "postgresql"
+  url      = "postgresql://postgres:t3Hs8gedKbJkAplB@35.233.14.44/dev?schema=main&sslmode=prefer"
+      enabled = true
+}
 model School {
-    id                 String             @default(cuid()) @id @unique
+    id                 String             @default(cuid()) @id
     name               String
     webstite           String?
     phone              String
     city String
@@ -21,9 +27,9 @@
     district String
 }
 model SchoolYear {
-    id                 String             @default(cuid()) @id @unique
+    id                 String             @default(cuid()) @id
     from      DateTime
     to        DateTime
     school School
     studentYears StudentYear[]
@@ -31,17 +37,17 @@
     skills Skill[]
 }
 model StudentYear {
-    id                 String             @default(cuid()) @id @unique
+    id                 String             @default(cuid()) @id
     schoolYear SchoolYear
     student Student
     classroom Classroom?
     ppre Ppre?
 }
 model Teacher {
-    id         String      @default(cuid()) @id @unique
+    id         String      @default(cuid()) @id
     firstName  String
     lastName   String
     school     School
     avatar     String?
@@ -53,9 +59,9 @@
     classrooms Classroom[]
 }
 model Student {
-    id         String             @default(cuid()) @id @unique
+    id         String             @default(cuid()) @id
     firstName  String
     lastName   String
     birthDate  DateTime
     gender     String
@@ -64,18 +70,18 @@
     studentYears StudentYear[]
 }
 model Classroom {
-    id                 String             @default(cuid()) @id @unique
+    id                 String             @default(cuid()) @id
     name               String
     teachers           Teacher[]
     academicLevel      String
     schoolYear SchoolYear
     studentYears StudentYear[]
 }
 model Ppre {
-    id                String            @default(cuid()) @id @unique
+    id                String            @default(cuid()) @id
     studentYear StudentYear
     globalAssessment  String?
     nature            String?
     schoolAttendance  String?
@@ -94,16 +100,16 @@
     councilRenewalOpinionDate DateTime?
 }
 model PpreCheckup {
-    id          String  @default(cuid()) @id @unique
+    id          String  @default(cuid()) @id
     ppre        Ppre
     assessment  String
     skillsWorked Skill[]
 }
 model Skill {
-    id                  String  @default(cuid()) @id @unique
+    id                  String  @default(cuid()) @id
     name                String
     children            Skill[] @relation(name: "SkillRelation")
     parent              Skill?  @relation(name: "SkillRelation", onDelete: CASCADE)
     schoolYear SchoolYear
@@ -111,9 +117,9 @@
     skillsToWorkPpres Ppre[] @relation(name: "SkillsToWorkToPPRE")
 }
 model Academy {
-    id         String             @default(cuid()) @id @unique
+    id         String             @default(cuid()) @id
     name String
     imageName String @unique
 }
```


